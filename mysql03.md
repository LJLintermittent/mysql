# 《MySQL技术内幕：InnoDB存储引擎》

## 第三章 文件

构成MySQL数据库和InnoDB存储引擎表的各种类型的文件

* 参数文件：告诉MySQL实例启动的时候在哪里可以找到数据库文件，并且指定某些初始化参数，这些参数定义了某种内存结构的大小等设置
* 日志文件：错误日志，二进制日志文件，慢查询日志文件，查询日志文件等
* socket文件
* pid文件：MySQL实例的进程ID文件
* MySQL表结构文件：用来存放MySQL表结构定义文件
* 存储引擎文件

其中二进制日志文件记录了对数据库执行更改的所有操作，不包括select和show这两类操作。

所以用户想要记录select和show这种类型的操作，可以使用查询日志。

除此以外二进制日志文件很重要的一点是可以用来恢复和复制，来达到mysql集群的主从复制的效果。

MySQL5.1开始引入了binlog_format参数，该参数可以设置的值有ROW和STATEMENT和MIXED

STATEMENT：表示二进制日志文件记录的是逻辑SQL语句

ROW：记录的不再是简单的SQL语句，而是记录表的行更改情况。

MIXED：混合模式，默认使用STATEMENT，但是有一些情况下会使用ROW：

* 表的存储引擎为NDB，这时对表的DML操作都会以ROW格式进行记录
* 使用过了UUID(),USER(),FOUND_ROWS(),ROW_COUNT()等不确定函数
* 使用了INSERT DELAY语句
* 使用了用户定义函数
* 使用了临时表

通常情况下，我会将参数设置为ROW，这可以为数据库的恢复和复制带来更好的可靠性，但是不可忽视的一点是，这会带来二进制文件大小的增加。

将参数设置为ROW格式，会对磁盘空间要求有一定的增加。而由于复制是采用传输二进制日志方式实现的，因此复制的网络开销也有所增加。

二进制日志文件的格式是二进制的（废话），所以对二进制文件的查看不可以使用cat，head，tail等命令来查看，必须使用mysql提供的工具mysqlbinlog。对于STATEMENT格式的二进制日志文件，在使用mysqlbinlog查看后，看到的就是执行的逻辑SQL语句。

而如果使用ROW格式的二进制日志文件，mysqlbinlog向我们解释了这条SQL语句所具体做的事情。